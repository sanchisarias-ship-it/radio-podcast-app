<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>üîé Buscador Potente de Radios & Podcasts</title>

<style>
:root{
  --bg:#0f172a; --card:#1f2937; --accent:#22c55e;
  --text:#e5e7eb; --muted:#9ca3af; --border:#1f2937;
}
*{box-sizing:border-box}
body{
  margin:0;font-family:system-ui,Arial;
  background:linear-gradient(180deg,#020617,#0f172a);
  color:var(--text)
}
header{
  padding:16px;text-align:center;font-weight:900;font-size:20px
}
main{padding:14px;max-width:980px;margin:auto}
.card{
  background:rgba(31,41,55,.9);
  border:1px solid var(--border);
  border-radius:18px;padding:14px;margin-bottom:14px
}
.row{display:flex;gap:8px;flex-wrap:wrap}
input,select,button{
  padding:12px;border-radius:14px;
  border:1px solid var(--border);
  background:#020617;color:#fff
}
button.primary{
  background:linear-gradient(135deg,#22c55e,#38bdf8);
  color:#000;font-weight:900
}
.list{display:grid;gap:10px}
.item{
  background:#020617;border:1px solid var(--border);
  border-radius:16px;padding:12px
}
.actions{display:flex;gap:6px;flex-wrap:wrap;margin-top:6px}
.muted{color:var(--muted);font-size:14px}
.badge{
  font-size:12px;padding:2px 8px;border-radius:999px;
  border:1px solid var(--border);margin-left:6px
}
</style>
</head>
<body>

<header>üîé Buscador Potente (sin backend)</header>

<main>
  <div class="card">
    <h3>B√∫squeda multi‚Äëfuente</h3>
    <div class="row">
      <input id="q" placeholder="SER Valencia, COPE Alicante, radio Elche, podcast local..."
             style="flex:1">
      <select id="type">
        <option value="all">Todo</option>
        <option value="radio">Radios</option>
        <option value="podcast">Podcasts</option>
      </select>
      <button class="primary" onclick="searchAll()">Buscar</button>
    </div>
    <p class="muted">
      Fuentes usadas: Radio‚ÄëBrowser, Apple Podcasts, PodcastIndex, Fyyd. <br>
      Consejo: escribe emisora + ciudad para resultados locales.
    </p>
  </div>

  <div class="card">
    <h3>Resultados</h3>
    <div id="status" class="muted">Introduce una b√∫squeda.</div>
    <div id="results" class="list"></div>
  </div>
</main>

<script>
const PROXY = "https://api.allorigins.win/raw?url=";

const resultsEl = document.getElementById("results");
const statusEl = document.getElementById("status");

function escape(s){return s.replace(/'/g,"\\'");}

function addResult(obj){
  const div = document.createElement("div");
  div.className="item";
  div.innerHTML = `
    <strong>${obj.title}</strong>
    <span class="badge">${obj.source}</span>
    ${obj.subtitle?`<p class="muted">${obj.subtitle}</p>`:""}
    <div class="actions">
      ${obj.playUrl?`<button onclick="play('${escape(obj.playUrl)}')">‚ñ∂ Escuchar</button>`:""}
      ${obj.url?`<a href="${obj.url}" target="_blank"><button>üåê Abrir</button></a>`:""}
    </div>`;
  resultsEl.appendChild(div);
}

function play(url){
  const audio = new Audio(url);
  audio.play();
}

async function searchAll(){
  const q = document.getElementById("q").value.trim();
  const type = document.getElementById("type").value;
  if(!q) return;

  resultsEl.innerHTML = "";
  statusEl.textContent = "Buscando en varias fuentes abiertas‚Ä¶";

  const tasks = [];
  if(type==="all" || type==="radio") tasks.push(searchRadios(q));
  if(type==="all" || type==="podcast"){
    tasks.push(searchApple(q));
    tasks.push(searchPodcastIndex(q));
    tasks.push(searchFyyd(q));
  }

  await Promise.allSettled(tasks);

  if(resultsEl.children.length===0){
    statusEl.textContent = "No se encontraron resultados. Prueba otra combinaci√≥n.";
  } else {
    statusEl.textContent = "Resultados combinados de varias fuentes.";
  }
}

/* ========== RADIO-BROWSER ========== */
async function searchRadios(q){
  try{
    const url = PROXY + encodeURIComponent(
      "https://de1.api.radio-browser.info/json/stations/search?name="+q+
      "&tag="+q+"&country="+q+"&limit=25"
    );
    const res = await fetch(url);
    const data = await res.json();
    data.forEach(r=>{
      addResult({
        title: r.name,
        subtitle: (r.state||"") + " " + (r.country||""),
        playUrl: r.url,
        url: r.homepage || r.url,
        source: "Radio-Browser"
      });
    });
  }catch(e){}
}

/* ========== APPLE PODCASTS ========== */
async function searchApple(q){
  try{
    const url = PROXY + encodeURIComponent(
      "https://itunes.apple.com/search?media=podcast&term="+q+"&limit=25"
    );
    const res = await fetch(url);
    const data = await res.json();
    data.results.forEach(p=>{
      addResult({
        title: p.collectionName,
        subtitle: p.artistName || "",
        url: p.collectionViewUrl,
        source: "Apple Podcasts"
      });
    });
  }catch(e){}
}

/* ========== PODCAST INDEX ========== */
async function searchPodcastIndex(q){
  try{
    const url = PROXY + encodeURIComponent(
      "https://api.podcastindex.org/api/1.0/search/byterm?q="+q
    );
    const res = await fetch(url);
    const data = await res.json();
    (data.feeds||[]).slice(0,20).forEach(p=>{
      addResult({
        title: p.title,
        subtitle: p.author || "",
        url: p.link || p.url,
        source: "Podcast Index"
      });
    });
  }catch(e){}
}

/* ========== FYYD ========== */
async function searchFyyd(q){
  try{
    const url = PROXY + encodeURIComponent(
      "https://api.fyyd.de/0.2/search/podcast?term="+q
    );
    const res = await fetch(url);
    const data = await res.json();
    (data.data||[]).slice(0,20).forEach(p=>{
      addResult({
        title: p.title,
        subtitle: p.author || "",
        url: p.url || "",
        source: "Fyyd"
      });
    });
  }catch(e){}
}
</script>
</body>
</html>