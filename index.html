<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>üîé Buscador multi‚Äëfuente de Radios & Podcasts</title>
<style>
:root{--bg:#0f172a;--card:#1f2937;--accent:#22c55e;--text:#e5e7eb;--muted:#9ca3af;--border:#1f2937}
*{box-sizing:border-box}
body{margin:0;font-family:system-ui,Arial;background:linear-gradient(180deg,#020617,#0f172a);color:var(--text)}
header{padding:16px;text-align:center;font-weight:900}
main{padding:14px;max-width:980px;margin:auto}
.card{background:rgba(31,41,55,.9);border:1px solid var(--border);border-radius:18px;padding:14px;margin-bottom:12px}
.row{display:flex;gap:8px;flex-wrap:wrap}
input,select,button{padding:12px;border-radius:14px;border:1px solid var(--border);background:#020617;color:#fff}
button.primary{background:linear-gradient(135deg,#22c55e,#38bdf8);color:#000;font-weight:900}
.list{display:grid;gap:10px}
.item{background:#020617;border:1px solid var(--border);border-radius:16px;padding:12px}
.actions{display:flex;gap:6px;flex-wrap:wrap}
.muted{color:var(--muted);font-size:14px}
.badge{font-size:12px;padding:2px 8px;border-radius:999px;border:1px solid var(--border);margin-left:6px}
.kbd{background:#020617;border:1px solid var(--border);border-radius:8px;padding:2px 6px;font-size:12px}
</style>
</head>
<body>
<header>üîé Buscador multi‚Äëfuente (Radios + Podcasts)</header>
<main>
  <div class="card">
    <h3>Buscar en varias fuentes a la vez</h3>
    <div class="row">
      <input id="q" placeholder="Ej: SER Valencia, COPE Alicante, rock Elche, historia Espa√±a..." style="flex:1">
      <select id="type">
        <option value="all">Todo</option>
        <option value="radio">Solo radios</option>
        <option value="podcast">Solo podcasts</option>
      </select>
      <button class="primary" onclick="searchAll()">Buscar</button>
    </div>
    <p class="muted">Fuentes: Radio‚ÄëBrowser, Apple Podcasts, Podcast Index (mirror), Listen Notes (mirror), iVoox (mirror).</p>
  </div>

  <div class="card">
    <h3>Resultados</h3>
    <div id="status" class="muted">Introduce una b√∫squeda.</div>
    <div id="results" class="list"></div>
  </div>
</main>

<script>
// CORS-friendly proxies / mirrors (public). For m√°xima fiabilidad, usa tu propio backend.
const ALLORIGINS = "https://api.allorigins.win/raw?url=";
const RSSHUB = "https://rsshub.app"; // mirror p√∫blico (puede variar en disponibilidad)

const resultsEl = document.getElementById("results");
const statusEl = document.getElementById("status");

function el(html){
  const d=document.createElement("div");
  d.innerHTML=html.trim();
  return d.firstChild;
}

function addResult({title, subtitle, url, source, playUrl}){
  const item = el(`
    <div class="item">
      <strong>${title}</strong>
      <span class="badge">${source}</span>
      ${subtitle?`<p class="muted">${subtitle}</p>`:""}
      <div class="actions">
        ${playUrl?`<button onclick="play('${playUrl.replace(/'/g,"")}','${title.replace(/'/g,"")}')">‚ñ∂ Reproducir</button>`:""}
        <a href="${url}" target="_blank"><button>üåê Abrir</button></a>
      </div>
    </div>`);
  resultsEl.appendChild(item);
}

function play(url,title){
  const audio = new Audio(url);
  audio.play();
}

async function searchAll(){
  const q = document.getElementById("q").value.trim();
  const type = document.getElementById("type").value;
  if(!q) return;

  resultsEl.innerHTML = "";
  statusEl.textContent = "Buscando en varias fuentes‚Ä¶";

  const tasks = [];
  if(type==="all" || type==="radio") tasks.push(searchRadios(q));
  if(type==="all" || type==="podcast"){
    tasks.push(searchApple(q));
    tasks.push(searchPodcastIndex(q));
    tasks.push(searchListenNotes(q));
    tasks.push(searchIVoox(q));
  }

  await Promise.allSettled(tasks);
  statusEl.textContent = "Resultados combinados de varias fuentes.";
}

/* ================== RADIOS (Radio-Browser) ================== */
async function searchRadios(q){
  try{
    const url = ALLORIGINS + encodeURIComponent(
      "https://de1.api.radio-browser.info/json/stations/search?name=" + q + "&tag=" + q + "&country=" + q + "&limit=20"
    );
    const res = await fetch(url);
    const data = await res.json();
    data.forEach(r=> addResult({
      title: r.name,
      subtitle: (r.country||"") + " " + (r.state||""),
      url: r.homepage || r.url,
      playUrl: r.url,
      source: "Radio-Browser"
    }));
  }catch(e){}
}

/* ================== APPLE PODCASTS ================== */
async function searchApple(q){
  try{
    const url = ALLORIGINS + encodeURIComponent(
      "https://itunes.apple.com/search?media=podcast&term=" + q + "&limit=20"
    );
    const res = await fetch(url);
    const data = await res.json();
    data.results.forEach(p=> addResult({
      title: p.collectionName,
      subtitle: p.artistName || "",
      url: p.collectionViewUrl,
      source: "Apple Podcasts"
    }));
  }catch(e){}
}

/* ================== PODCAST INDEX (mirror) ================== */
async function searchPodcastIndex(q){
  try{
    const url = ALLORIGINS + encodeURIComponent(
      "https://api.podcastindex.org/api/1.0/search/byterm?q=" + q
    );
    const res = await fetch(url);
    const data = await res.json();
    (data.feeds||[]).slice(0,15).forEach(p=> addResult({
      title: p.title,
      subtitle: p.author || "",
      url: p.link || p.url,
      source: "Podcast Index"
    }));
  }catch(e){}
}

/* ================== LISTEN NOTES (via RSSHub search mirror) ================== */
async function searchListenNotes(q){
  try{
    const url = ALLORIGINS + encodeURIComponent(
      RSSHUB + "/listennotes/search/" + encodeURIComponent(q)
    );
    const res = await fetch(url);
    const text = await res.text();
    const xml = new DOMParser().parseFromString(text,"text/xml");
    [...xml.querySelectorAll("item")].slice(0,10).forEach(i=>{
      addResult({
        title: i.querySelector("title")?.textContent || "Podcast",
        subtitle: i.querySelector("description")?.textContent?.slice(0,80) || "",
        url: i.querySelector("link")?.textContent || "#",
        source: "Listen Notes"
      });
    });
  }catch(e){}
}

/* ================== IVOOX (via RSSHub search mirror) ================== */
async function searchIVoox(q){
  try{
    const url = ALLORIGINS + encodeURIComponent(
      RSSHUB + "/ivoox/search/" + encodeURIComponent(q)
    );
    const res = await fetch(url);
    const text = await res.text();
    const xml = new DOMParser().parseFromString(text,"text/xml");
    [...xml.querySelectorAll("item")].slice(0,10).forEach(i=>{
      addResult({
        title: i.querySelector("title")?.textContent || "Programa iVoox",
        subtitle: "iVoox",
        url: i.querySelector("link")?.textContent || "#",
        source: "iVoox"
      });
    });
  }catch(e){}
}
</script>
</body>
</html>