<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>üìªüéô App Radios & Podcasts</title>
<style>
:root{--bg:#0f172a;--card:#1f2937;--accent:#22c55e;--text:#e5e7eb;--muted:#9ca3af;--border:#1f2937}
*{box-sizing:border-box}
body{margin:0;font-family:system-ui,Arial;background:linear-gradient(180deg,#020617,#0f172a);color:var(--text)}
header{padding:14px;text-align:center;font-weight:900}
nav{display:flex;gap:6px;padding:10px;position:sticky;top:0;background:#020617;z-index:10}
nav button{flex:1;padding:10px;border-radius:14px;border:1px solid var(--border);background:#020617;color:#fff}
nav button.active{background:linear-gradient(135deg,#22c55e,#38bdf8);color:#000;font-weight:900}
.section{display:none;padding:14px}
.section.active{display:block}
.card{background:rgba(31,41,55,.9);border:1px solid var(--border);border-radius:18px;padding:14px;margin-bottom:12px}
.row{display:flex;gap:8px;flex-wrap:wrap}
input,select,button{padding:12px;border-radius:14px;border:1px solid var(--border);background:#020617;color:#fff}
button.primary{background:linear-gradient(135deg,#22c55e,#38bdf8);color:#000;font-weight:900}
.list{display:grid;gap:10px}
.item{background:#020617;border:1px solid var(--border);border-radius:16px;padding:12px}
.actions{display:flex;gap:6px;flex-wrap:wrap}
.muted{color:var(--muted);font-size:14px}
.badge{font-size:12px;padding:2px 8px;border-radius:999px;border:1px solid var(--border);margin-left:6px}
.star{font-size:18px}
</style>
</head>
<body>
<header>üìªüéô Buscador Profesional</header>

<nav>
  <button onclick="show('buscar')" class="active">Buscar</button>
  <button onclick="show('favradios')">‚≠ê Radios fav</button>
  <button onclick="show('favpodcasts')">‚≠ê Podcasts fav</button>
</nav>

<div id="buscar" class="section active">
  <div class="card">
    <h3>üîé B√∫squeda multi-fuente</h3>
    <div class="row">
      <input id="q" placeholder="SER Valencia, COPE Alicante, rock Elche...">
      <select id="type">
        <option value="all">Todo</option>
        <option value="radio">Radios</option>
        <option value="podcast">Podcasts</option>
      </select>
      <button class="primary" onclick="search()">Buscar</button>
    </div>
    <p class="muted">Usa emisora + ciudad para encontrar contenido local.</p>
  </div>

  <div class="card">
    <h3>Resultados</h3>
    <div id="results" class="list"></div>
  </div>
</div>

<div id="favradios" class="section">
  <div class="card">
    <h3>‚≠ê Emisoras favoritas</h3>
    <div id="radiosFavList" class="list"></div>
  </div>
</div>

<div id="favpodcasts" class="section">
  <div class="card">
    <h3>‚≠ê Podcasts favoritos</h3>
    <div id="podFavList" class="list"></div>
  </div>
</div>

<script>
// üëâ Pega aqu√≠ la URL de tu backend desplegado
const API = "https://TU-WORKER.AQUI.workers.dev/search";

const get=(k,d=[])=>JSON.parse(localStorage.getItem(k)||JSON.stringify(d));
const set=(k,v)=>localStorage.setItem(k,JSON.stringify(v));

function show(id){
  document.querySelectorAll('.section').forEach(s=>s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  document.querySelectorAll('nav button').forEach(b=>b.classList.remove('active'));
  event.target.classList.add('active');
}

async function search(){
  const q = document.getElementById("q").value.trim();
  const type = document.getElementById("type").value;
  if(!q) return;
  results.innerHTML = "<div class='muted'>Buscando‚Ä¶</div>";
  try{
    const res = await fetch(API + "?q=" + encodeURIComponent(q) + "&type=" + type);
    const data = await res.json();
    results.innerHTML = "";
    data.results.forEach(r => {
      const key = r.type==="radio" ? "favRadios" : "favPods";
      const favs = get(key);
      const isFav = favs.some(f => f.title === r.title);
      const div = document.createElement("div");
      div.className = "item";
      div.innerHTML = `
        <strong>${r.title}</strong>
        <span class="badge">${r.source}</span>
        <p class="muted">${r.subtitle || ""}</p>
        <div class="actions">
          ${r.playUrl?`<button onclick="play('${r.playUrl}')">‚ñ∂</button>`:""}
          <button class="star" onclick="toggleFav('${r.type}', ${JSON.stringify(r).replace(/"/g,'&quot;')})">
            ${isFav?'‚≠ê':'‚òÜ'}
          </button>
        </div>`;
      results.appendChild(div);
    });
  }catch{
    results.innerHTML = "<div class='muted'>Error conectando al backend.</div>";
  }
}

function toggleFav(type,obj){
  const key = type==="radio" ? "favRadios" : "favPods";
  let arr = get(key);
  const i = arr.findIndex(x=>x.title===obj.title);
  if(i>=0) arr.splice(i,1);
  else arr.push(obj);
  set(key,arr);
  renderFavs();
  search();
}

function renderFavs(){
  radiosFavList.innerHTML="";
  podFavList.innerHTML="";
  get("favRadios").forEach(r=>{
    const d=document.createElement("div");
    d.className="item";
    d.innerHTML=`<strong>${r.title}</strong><span class="badge">${r.source}</span>
    <div class="actions"><button onclick="play('${r.playUrl}')">‚ñ∂</button></div>`;
    radiosFavList.appendChild(d);
  });
  get("favPods").forEach(p=>{
    const d=document.createElement("div");
    d.className="item";
    d.innerHTML=`<strong>${p.title}</strong><span class="badge">${p.source}</span>
    <p class="muted">${p.subtitle||""}</p>`;
    podFavList.appendChild(d);
  });
}

function play(url){ new Audio(url).play(); }

renderFavs();
</script>
</body>
</html>